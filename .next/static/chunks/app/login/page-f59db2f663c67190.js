(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{4236:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var r=s(12115),o=s(34355);let a=()=>{let[e,t]=(0,r.useState)(void 0),[s,a]=(0,r.useState)(!0),[n,l]=(0,r.useState)(!1),[c,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{try{let e=localStorage.getItem("access_token");e?(i(e),l(!0)):(a(!1),l(!1))}catch(e){console.error("Error accessing localStorage:",e),a(!1),l(!1)}},[]),(0,r.useEffect)(()=>{if(!c)return void a(!1);(async()=>{try{let e=c.startsWith('"')&&c.endsWith('"')?c.slice(1,-1):c,s=o.$.getInstance(e),r=await s.getUser();if(r)t(r),l(!0);else throw Error("Invalid user data received")}catch(e){console.error("Failed to fetch user:",e),e instanceof Error&&"Failed to fetch"!==e.message&&(localStorage.removeItem("access_token"),l(!1),t(void 0))}finally{a(!1)}})()},[c]),{user:e,isLoading:s,isAuthenticated:n,setIsAuthenticated:l,setUser:t,refreshAuth:async()=>{let e=localStorage.getItem("access_token");e&&i(e)}}}},9100:(e,t,s)=>{Promise.resolve().then(s.bind(s,78007))},35695:(e,t,s)=>{"use strict";var r=s(18999);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},78007:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(95155),o=s(12115),a=s(34355),n=s(35695),l=s(4236);function c(){let e=(0,n.useRouter)(),{isAuthenticated:t,isLoading:s,setIsAuthenticated:c,refreshAuth:i}=(0,l.A)(),[u,d]=(0,o.useState)("+91"),[g,m]=(0,o.useState)(""),[h,f]=(0,o.useState)(""),[x,y]=(0,o.useState)(!1),[b,v]=(0,o.useState)(!1),[p,N]=(0,o.useState)(""),[j,k]=(0,o.useState)("");(0,o.useEffect)(()=>{let e=localStorage.getItem("lastPhoneNumber");e&&m(e)},[]),(0,o.useEffect)(()=>{t&&!s&&e.push("/")},[t,s,e]);let P=async e=>{if(e.preventDefault(),!g)return void N("Please enter your phone number");try{v(!0),N(""),k(""),localStorage.setItem("lastPhoneNumber",g);let e=a.$.getInstance(),t=await e.loginRequest(u,g);y(!0),k(t.message||"OTP sent successfully")}catch(e){console.error("Failed to send OTP:",e),N("Failed to send OTP. Please try again.")}finally{v(!1)}},S=e=>{var t;return(console.log("API Response:",JSON.stringify(e,null,2)),e.access_token)?e.access_token:e.token?e.token:(null==(t=e.data)?void 0:t.access_token)?e.data.access_token:null},w=(0,o.useCallback)(()=>{console.log("Login successful, handling redirection"),c&&c(!0),i&&i(),setTimeout(()=>{console.log("Navigating to home page"),window.location.href="/"},1500)},[c,i]),E=async e=>{if(e.preventDefault(),!h)return void N("Please enter the OTP");try{v(!0),N(""),k("");let e=a.$.getInstance();try{var t;let s=await e.verifyAccountAccess(u,g,h);if(console.log("OTP Verification Response:",JSON.stringify(s,null,2)),null==(t=s.message)?void 0:t.toLowerCase().includes("invalid otp"))throw Error("Invalid OTP. Please check and try again.");let r=S(s);if(!r)throw Error("Authentication failed: No access token received from server");try{console.log("Storing token in localStorage:",r.substring(0,10)+"..."),localStorage.removeItem("access_token"),localStorage.setItem("access_token",r);let e=localStorage.getItem("access_token");if(!e)throw Error("Failed to verify token was stored correctly");console.log("Token stored successfully, length:",e.length),k("Login successful"),a.$.getInstance(r),w()}catch(e){throw console.error("Error storing token in localStorage:",e),Error("Failed to store authentication token. Please try again.")}}catch(e){throw e}}catch(e){console.error("Failed to verify OTP:",e),e instanceof Error?N(e.message):N("Failed to verify OTP. Please try again."),f("")}finally{v(!1)}};return s?(0,r.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-16 h-16 border-4 border-gray-200 border-t-4 border-t-orange-500 rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-medium text-gray-700 mb-1",children:"Loading"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Checking your login status..."})]})}):(0,r.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"w-full max-w-md bg-white rounded-lg shadow-md p-8 border border-gray-100",children:[(0,r.jsxs)("div",{className:"mb-8 text-center",children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("img",{src:"/logo1.svg",alt:"JEEVIC Logo",className:"h-10"})}),(0,r.jsx)("h1",{className:"text-2xl font-medium text-gray-900",children:"Admin Dashboard"}),(0,r.jsx)("p",{className:"text-gray-500 mt-2 text-sm",children:"Enter your credentials to access the dashboard"})]}),p&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-md text-sm",children:p}),j&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-green-50 text-green-700 rounded-md text-sm",children:j}),x?(0,r.jsxs)("form",{onSubmit:E,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700 mb-1",children:"OTP"}),(0,r.jsx)("input",{id:"otp",type:"text",placeholder:"Enter OTP",value:h,onChange:e=>f(e.target.value),maxLength:6,className:"w-full text-center text-xl placeholder:text-gray-400 text-black tracking-widest rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",required:!0}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 text-center mt-2",children:["OTP sent to ",u," ",g]})]}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-orange-500 text-white py-2 px-4 rounded-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors text-sm font-medium",disabled:b,children:b?"Verifying...":"Verify OTP"}),(0,r.jsx)("button",{type:"button",className:"w-full text-orange-500 hover:text-orange-600 underline py-2 text-sm",onClick:()=>{y(!1),N(""),k("")},disabled:b,children:"Change Phone Number"})]}):(0,r.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("select",{value:u,onChange:e=>d(e.target.value),className:"w-28 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 text-black focus:ring-orange-500 text-sm",children:(0,r.jsx)("option",{value:"+91",children:"+91"})}),(0,r.jsx)("input",{id:"phone",type:"tel",placeholder:"Enter phone number",value:g,onChange:e=>m(e.target.value),className:"flex-1 rounded-md border text-black placeholder:text-gray-400 border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm",required:!0})]})]}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-orange-500 text-white py-2 px-4 rounded-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors text-sm font-medium",disabled:b,children:b?"Sending OTP...":"Send OTP"})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[997,355,441,684,358],()=>t(9100)),_N_E=e.O()}]);