(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[337],{7964:(e,t,a)=>{"use strict";a.d(t,{SalesManagement:()=>i});var d=a(95155),l=a(12115),r=a(34355),s=a(29869),o=a(54861);function n(e){let{sale:t,onClose:a,onSave:n}=e,[i,c]=(0,l.useState)({...t,start_date:new Date(t.start_date).toISOString().split("T")[0],end_date:new Date(t.end_date).toISOString().split("T")[0]}),[p,u]=(0,l.useState)(t.image_url||[]),[m,x]=(0,l.useState)([]),[g,h]=(0,l.useState)([]),[b,y]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{try{let e=r.$.getInstance(),[t,a]=await Promise.all([e.getAllCategories(),e.getAllSubCategories()]);x(t),y(a);let d=t.map(e=>e.id),l=await Promise.all(d.map(t=>e.getProductByCategoryId(t)));h(l.flat())}catch(e){console.error("Failed to fetch data:",e)}})()},[]);let f=e=>{let{name:t,value:a}=e.target;c({...i,[t]:a})},j=async e=>{if(e.target.files){let t=r.$.getInstance();u([...p,...await Promise.all(Array.from(e.target.files).map(async e=>(await t.uploadFile(e)).url))])}},w=e=>{u(p.filter((t,a)=>a!==e))},_=(e,t)=>{c({...i,[e]:t})},v=async e=>{e.preventDefault();try{let e={...i,start_date:new Date(i.start_date),end_date:new Date(i.end_date),image_url:p,product_ids:i.product_ids,category_ids:i.category_ids,subcategory_ids:i.subcategory_ids,meta_data:JSON.parse(i.meta_data),created_at:t.created_at,updated_at:new Date};e.id?await r.$.getInstance().updateSale(e.id,e):await r.$.getInstance().createSale(e),n(),a()}catch(e){console.error("Failed to save sale:",e),alert("Invalid Meta Data JSON.")}};return(0,d.jsx)("div",{className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 z-50 overflow-y-auto flex items-center justify-center",children:(0,d.jsxs)("div",{className:"bg-white p-6 w-full max-w-lg rounded-xl shadow-lg",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold mb-4",children:i.id?"Edit Sale":"Create Sale"}),(0,d.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[["name","description"].map(e=>(0,d.jsx)("input",{type:"text",name:e,value:i[e],onChange:f,placeholder:e.charAt(0).toUpperCase()+e.slice(1),className:"w-full p-2 border rounded-md",required:"name"===e},e)),(0,d.jsx)("input",{type:"number",name:"discount_percentage",value:i.discount_percentage,onChange:f,placeholder:"Discount (%)",className:"w-full p-2 border rounded-md",required:!0}),["start_date","end_date"].map(e=>(0,d.jsx)("input",{type:"date",name:e,value:i[e],onChange:f,className:"w-full p-2 border rounded-md",required:!0},e)),(0,d.jsxs)("select",{name:"sale_type",value:i.sale_type,onChange:f,className:"w-full p-2 border rounded-md",children:[(0,d.jsx)("option",{value:"product",children:"Product"}),(0,d.jsx)("option",{value:"category",children:"Category"}),(0,d.jsx)("option",{value:"subcategory",children:"Subcategory"})]}),[{label:"Categories",name:"category_ids",data:m},{label:"Products",name:"product_ids",data:g},{label:"Subcategories",name:"subcategory_ids",data:b}].map(e=>{let{label:t,name:a,data:l}=e;return(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block font-medium mb-1",children:t}),(0,d.jsx)("select",{multiple:!0,value:i[a],onChange:e=>_(a,Array.from(e.target.selectedOptions,e=>e.value)),className:"w-full p-2 border rounded-md",children:l.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))})]},a)}),(0,d.jsx)("textarea",{name:"meta_data",value:JSON.stringify(i.meta_data,null,2),onChange:f,rows:5,className:"w-full p-2 border rounded-md font-mono"}),(0,d.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-4 text-center",children:[(0,d.jsx)("input",{type:"file",accept:"image/png, image/jpeg, image/jpg",multiple:!0,onChange:j,className:"hidden",id:"imageUpload"}),(0,d.jsxs)("label",{htmlFor:"imageUpload",className:"cursor-pointer text-gray-600 flex flex-col items-center",children:[(0,d.jsx)(s.A,{className:"h-8 w-8 mb-1"}),(0,d.jsx)("span",{children:"Select images"})]})]}),(0,d.jsx)("div",{className:"flex flex-wrap gap-2",children:p.map((e,t)=>(0,d.jsxs)("div",{className:"relative w-16 h-16 border rounded overflow-hidden",children:[(0,d.jsx)("img",{src:e,className:"w-full h-full object-cover",alt:"Sale"}),(0,d.jsx)("button",{type:"button",onClick:()=>w(t),className:"absolute top-0 right-0 bg-white rounded-full",children:(0,d.jsx)(o.A,{className:"h-4 w-4 text-red-500"})})]},t))}),(0,d.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,d.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded-md",children:"Save"}),(0,d.jsx)("button",{type:"button",onClick:a,className:"bg-red-500 text-white px-4 py-2 rounded-md",children:"Cancel"})]})]})]})})}function i(){let[e,t]=(0,l.useState)([]),[a,s]=(0,l.useState)(null);(0,l.useEffect)(()=>{i()},[]);let o={id:"",name:"",image_url:[],description:"",start_date:new Date,end_date:new Date,discount_percentage:0,sale_type:"product",product_ids:[],category_ids:[],subcategory_ids:[],meta_data:{},created_at:new Date,updated_at:new Date},i=async()=>{try{let e=await r.$.getInstance().getSales();t(e)}catch(e){console.error("Failed to load sales:",e)}},c=async e=>{if(window.confirm("Are you sure you want to delete this sale?"))try{await r.$.getInstance().deleteSale(e),i()}catch(e){console.error("Failed to delete sale:",e)}};return(0,d.jsxs)("div",{style:{padding:"20px",backgroundColor:"#f9f9f9"},children:[(0,d.jsx)("button",{style:{backgroundColor:"#4CAF50",color:"white",padding:"10px 20px",marginBottom:"20px",border:"none",borderRadius:"5px",cursor:"pointer"},onClick:()=>s(o),children:"Create New Sale"}),(0,d.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{style:{backgroundColor:"#f2f2f2"},children:[(0,d.jsx)("th",{style:{padding:"10px",borderBottom:"1px solid #ddd",color:"black"},children:"Name"}),(0,d.jsx)("th",{style:{padding:"10px",borderBottom:"1px solid #ddd",color:"black"},children:"Start Date"}),(0,d.jsx)("th",{style:{padding:"10px",borderBottom:"1px solid #ddd",color:"black"},children:"End Date"}),(0,d.jsx)("th",{style:{padding:"10px",borderBottom:"1px solid #ddd",color:"black"},children:"Actions"})]})}),(0,d.jsx)("tbody",{children:e.map(e=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{style:{padding:"10px",borderBottom:"1px solid #ddd"},children:e.name}),(0,d.jsx)("td",{style:{padding:"10px",borderBottom:"1px solid #ddd"},children:new Date(e.start_date).toLocaleDateString()}),(0,d.jsx)("td",{style:{padding:"10px",borderBottom:"1px solid #ddd"},children:new Date(e.end_date).toLocaleDateString()}),(0,d.jsxs)("td",{style:{padding:"10px",borderBottom:"1px solid #ddd"},children:[(0,d.jsx)("button",{style:{backgroundColor:"#008CBA",color:"white",padding:"5px 10px",marginRight:"5px",border:"none",borderRadius:"5px",cursor:"pointer"},onClick:()=>s(e),children:"Edit"}),(0,d.jsx)("button",{style:{backgroundColor:"#f44336",color:"white",padding:"5px 10px",border:"none",borderRadius:"5px",cursor:"pointer"},onClick:()=>c(e.id),children:"Delete"})]})]},e.id))})]}),a&&(0,d.jsx)(n,{sale:a,onClose:()=>s(null),onSave:i})]})}},29869:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});let d=(0,a(19946).A)("upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},41718:(e,t,a)=>{Promise.resolve().then(a.bind(a,7964)),Promise.resolve().then(a.t.bind(a,6874,23))},54861:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});let d=(0,a(19946).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[997,95,355,441,684,358],()=>t(41718)),_N_E=e.O()}]);