(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4236:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(12115),r=s(34355);let l=()=>{let[e,t]=(0,a.useState)(void 0),[s,l]=(0,a.useState)(!0),[n,i]=(0,a.useState)(!1),[c,o]=(0,a.useState)(null);return(0,a.useEffect)(()=>{try{let e=localStorage.getItem("access_token");e?(o(e),i(!0)):(l(!1),i(!1))}catch(e){console.error("Error accessing localStorage:",e),l(!1),i(!1)}},[]),(0,a.useEffect)(()=>{if(!c)return void l(!1);(async()=>{try{let e=c.startsWith('"')&&c.endsWith('"')?c.slice(1,-1):c,s=r.$.getInstance(e),a=await s.getUser();if(a&&["admin","cafe_admin","ecommerce_admin"].includes(a.role))t(a),i(!0);else throw Error("User does not have the required role")}catch(e){console.error("Failed to fetch user:",e),e instanceof Error&&"Failed to fetch"!==e.message&&(localStorage.removeItem("access_token"),i(!1),t(void 0))}finally{l(!1)}})()},[c]),{user:e,isLoading:s,isAuthenticated:n,setIsAuthenticated:i,setUser:t,refreshAuth:async()=>{let e=localStorage.getItem("access_token");e&&o(e)}}}},31881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var a=s(95155),r=s(12115),l=s(41004),n=s(37475),i=s(17580),c=s(86151),o=s(33109),d=s(68500),u=s(34355);function h(){let[e,t]=(0,r.useState)(0),[s,l]=(0,r.useState)({todayRevenue:0,totalItems:0,totalRevenue:0,profitPercentage:0});(0,r.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("access_token"),s=u.$.getInstance(e),[a,r]=await Promise.all([s.getAdminUsers(),s.getAllStats()]);t(a.data.total);let n=r.data.salesOfAllProducts.reduce((e,t)=>{let s=t.dishes.reduce((e,t)=>e+(Number(t.count)||0),0);return e+s},0),i=new Date,c="".concat(i.getDate(),"-").concat(i.getMonth()+1,"-").concat(i.getFullYear()),o=r.data.dailyProfits[c]||0;l({todayRevenue:o,totalItems:n,totalRevenue:r.data.totalProfit,profitPercentage:parseFloat(r.data.profitPercentage)})}catch(e){console.error("Failed to fetch metrics:",e)}})()},[]);let o=e=>e>=1e7?"".concat((e/1e7).toFixed(2),"Cr INR"):e>=1e5?"".concat((e/1e5).toFixed(2),"L INR"):e>=1e3?"".concat((e/1e3).toFixed(2),"K INR"):"".concat(e," INR");return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)(m,{title:"Today Revenue",value:o(s.todayRevenue),change:s.profitPercentage,icon:(0,a.jsx)(n.A,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)(m,{title:"Total Customers",value:e,icon:(0,a.jsx)(i.A,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)(m,{title:"Total Items Ordered",value:s.totalItems.toString(),icon:(0,a.jsx)(c.A,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)(m,{title:"Total Revenue",value:o(s.totalRevenue),icon:(0,a.jsx)(n.A,{className:"h-5 w-5 text-gray-400"})})]})}function m(e){let{title:t,value:s,change:r,icon:l}=e;return(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center text-gray-400 mb-2",children:[l,(0,a.jsx)("span",{className:"text-sm text-gray-400 ml-2",children:t})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-2xl text-black font-bold",children:s}),"Today Revenue"===t&&void 0!==r&&(0,a.jsxs)("div",{className:"flex items-center text-sm ".concat(r>=0?"text-green-500":"text-red-500"),children:[r>=0?(0,a.jsx)(o.A,{className:"h-4 w-4 mr-1"}):(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),(0,a.jsxs)("span",{children:[r>=0?"+":"",r.toFixed(2),"%"]})]})]})]})}var x=s(83540),g=s(93504),f=s(94754),y=s(96025),j=s(16238),v=s(94517),p=s(21374);function b(e){let{selectedTimeRange:t}=e,[s,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)({sevenDays:[],thirtyDays:[],ninetyDays:[]});(0,r.useEffect)(()=>{l(!0),c()},[]),(0,r.useEffect)(()=>{s&&t&&c()},[t,s]);let c=async()=>{try{let e=u.$.getInstance(),t=(await e.getAllStats()).data.revenueHistory,s={sevenDays:Object.entries(t.sevenDays||{}).map(e=>{let[t,s]=e;return{name:t,value:s}}),thirtyDays:Object.entries(t.thirtyDays||{}).map(e=>{let[t,s]=e;return{name:t,value:s}}),ninetyDays:Object.entries(t.ninetyDays||{}).map(e=>{let[t,s]=e;return{name:t,value:s}})};console.log("Transformed Revenue Data:",s),i(s)}catch(e){console.error("Failed to fetch revenue data:",e)}},o=n[({"7d":"sevenDays","30d":"thirtyDays","90d":"ninetyDays"})[t]]||[],d=e=>e>=1e7?"".concat((e/1e7).toFixed(1),"Cr"):e>=1e5?"".concat((e/1e5).toFixed(1),"L"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toString();return s&&0!==o.length?(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(x.u,{width:"100%",height:"100%",children:(0,a.jsxs)(g.b,{data:o,margin:{top:5,right:20,left:0,bottom:5},children:[(0,a.jsx)(f.d,{strokeDasharray:"3 3",vertical:!1}),(0,a.jsx)(y.W,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:12},interval:o.length>10?"preserveStartEnd":0,tickFormatter:e=>e.split("-")[0]}),(0,a.jsx)(j.h,{axisLine:!1,tickLine:!1,tick:{fontSize:12},tickFormatter:d}),(0,a.jsx)(v.m,{formatter:e=>["â‚¹".concat(d(e)),"Revenue"],contentStyle:{borderRadius:"8px",border:"1px solid #e2e8f0"}}),(0,a.jsx)(p.N,{type:"monotone",dataKey:"value",stroke:"#F97316",strokeWidth:2,dot:{r:4,fill:"#F97316",strokeWidth:2,stroke:"#FFF"},activeDot:{r:6,fill:"#F97316",strokeWidth:2,stroke:"#FFF"}})]})})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center",children:"Loading chart..."})}var N=s(8782),k=s(34e3),w=s(54811);let F=["#4ADE80","#A855F7","#F97316","#EAB308","#3B82F6","#EC4899","#14B8A6","#8B5CF6","#F43F5E","#06B6D4"];function S(){let[e,t]=(0,r.useState)(!1),[s,l]=(0,r.useState)([]);(0,r.useEffect)(()=>{t(!0),n()},[]);let n=async()=>{try{let e=u.$.getInstance(),t=(await e.getAllStats()).data.salesOfProducts.filter(e=>e.count>0).sort((e,t)=>t.count-e.count).map((e,t)=>({name:e.name,value:Number(e.count),color:F[t%F.length]}));l(t)}catch(e){console.error("Failed to fetch sales data:",e),l([])}};return e?(0,a.jsxs)("div",{className:"h-64 relative",children:[(0,a.jsx)(x.u,{width:"100%",height:"100%",children:(0,a.jsx)(N.r,{children:(0,a.jsx)(k.F,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",children:s.map(e=>(0,a.jsx)(w.f,{fill:e.color},e.name))})})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 flex flex-wrap justify-center gap-x-4 gap-y-2",children:s.map(e=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"w-3 h-3 rounded-full mr-1",style:{backgroundColor:e.color}}),(0,a.jsxs)("span",{className:"text-xs text-black",children:[e.name," (",e.value,")"]})]},e.name))})]}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center",children:"Loading chart..."})}function D(e){let{selectedTimeRange:t}=e,[s,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)({sevenDays:[],thirtyDays:[],ninetyDays:[]});(0,r.useEffect)(()=>{l(!0),c()},[]),(0,r.useEffect)(()=>{s&&t&&c()},[t,s]);let c=async()=>{try{let e=u.$.getInstance(),t=await e.getAllStats(),s=e=>Object.entries(e).map(e=>{let[t,s]=e,a=Object.entries(s).map(e=>{let[t,s]=e;return{hour:parseInt(t),orders:s}}),r=a.reduce((e,t)=>t.orders>e.orders?t:e,a[0]);return{name:t,hour:r.hour,orders:r.orders}});i({sevenDays:s(t.data.peakHours.sevenDays),thirtyDays:s(t.data.peakHours.thirtyDays),ninetyDays:s(t.data.peakHours.ninetyDays)})}catch(e){console.error("Failed to fetch peak hour data:",e)}},o=n[({"7d":"sevenDays","30d":"thirtyDays","90d":"ninetyDays"})[t]]||[],d=e=>12===e?"12 PM":0===e||24===e?"12 AM":e>12?"".concat(e-12," PM"):"".concat(e," AM");return s&&0!==o.length?(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(x.u,{width:"100%",height:"100%",children:(0,a.jsxs)(g.b,{data:o,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(f.d,{strokeDasharray:"3 3",horizontal:!0,vertical:!1}),(0,a.jsx)(y.W,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#6B7280"}}),(0,a.jsx)(j.h,{axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#6B7280"},domain:[0,24],ticks:[0,6,12,18,24],tickFormatter:d}),(0,a.jsx)(v.m,{formatter:e=>[d(e),"Peak Hour"],labelFormatter:e=>"Date: ".concat(e),contentStyle:{backgroundColor:"white",borderRadius:"8px",border:"1px solid #e2e8f0",padding:"8px"}}),(0,a.jsx)(p.N,{type:"monotone",dataKey:"hour",stroke:"#F97316",strokeWidth:2,dot:{r:4,fill:"#F97316",strokeWidth:2,stroke:"#FFF"},activeDot:{r:6,fill:"#F97316",strokeWidth:2,stroke:"#FFF"}})]})})}):(0,a.jsx)("div",{className:"h-64 w-full flex items-center justify-center",children:"Loading chart..."})}function A(e){let{selectedCategory:t}=e,[s,l]=(0,r.useState)([]);(0,r.useEffect)(()=>{n()},[t]);let n=async()=>{try{let e=u.$.getInstance(),s=(await e.getAllStats()).data.salesOfAllProducts.filter(e=>e.category.id===t).flatMap(e=>e.dishes.map(e=>({product:e.name,units:e.count}))).sort((e,t)=>t.units-e.units);l(s)}catch(e){console.error("Failed to fetch sold items:",e),l([])}};return 0===s.length?(0,a.jsx)("div",{className:"mb-4 text-center text-gray-500 py-4",children:"No items found for this category"}):(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-sm text-black",children:[(0,a.jsx)("th",{className:"pb-2 font-medium",children:"Product"}),(0,a.jsx)("th",{className:"pb-2 font-medium",children:"Units Sold"})]})}),(0,a.jsx)("tbody",{children:s.map((e,t)=>(0,a.jsxs)("tr",{className:"text-gray-700 text-sm",children:[(0,a.jsx)("td",{className:"py-2",children:e.product}),(0,a.jsx)("td",{className:"py-2",children:e.units})]},t))})]})})}function L(e){let{selectedCategory:t}=e,[s,l]=(0,r.useState)([]),[n,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{c()},[t]);let c=async()=>{try{i(!0);let e=u.$.getInstance(),[s,a]=await Promise.all([e.getAllStats(),e.getDishes()]),r=new Map(a.map(e=>[e.id,{picture:e.picture,category:e.dish_category_id}])),n=s.data.salesOfAllProducts.flatMap(e=>e.dishes.map(e=>{let t=r.get(e.id);return{id:e.id,name:e.name,units:e.count,image:(null==t?void 0:t.picture)||"/placeholder.svg",category:(null==t?void 0:t.category)||""}})).filter(e=>e.category.toLowerCase()===t.toLowerCase()).sort((e,t)=>t.units-e.units);l(n)}catch(e){console.error("Failed to fetch products:",e),l([])}finally{i(!1)}};return n?(0,a.jsx)("div",{className:"flex justify-center items-center h-32",children:"Loading..."}):0===s.length?(0,a.jsx)("div",{className:"flex justify-center items-center h-32",children:"No products found for this category"}):(0,a.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-2",children:s.map(e=>(0,a.jsxs)("div",{className:"flex-shrink-0 border rounded-lg p-3 flex items-center gap-3 min-w-[200px]",children:[(0,a.jsx)("img",{src:e.image,alt:e.name,className:"w-12 h-12 rounded-md object-cover"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-orange-500",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-black",children:[e.units," Units sold"]})]})]},e.id))})}var C=s(4236),E=s(190),I=s(33096);function P(e){let{options:t,defaultValue:s,value:r,onValueChange:l}=e;return(0,a.jsxs)(E.bL,{defaultValue:s,value:r,onValueChange:l,children:[(0,a.jsxs)(E.l9,{className:"inline-flex items-center justify-between bg-white border border-gray-200 rounded-md px-3 py-1.5 text-sm text-gray-800 hover:border-orange-300 focus:border-orange-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500/25 gap-2",children:[(0,a.jsx)(E.WT,{}),(0,a.jsx)(E.In,{children:(0,a.jsx)(I.D3D,{className:"h-4 w-4 text-gray-400"})})]}),(0,a.jsx)(E.ZL,{children:(0,a.jsx)(E.UC,{className:"overflow-hidden bg-white border border-gray-200 rounded-md shadow-lg",children:(0,a.jsx)(E.LM,{children:t.map(e=>(0,a.jsx)(E.q7,{value:e.value,className:"text-sm text-gray-800 px-3 py-2 hover:bg-orange-50 hover:text-orange-700 focus:outline-none focus:bg-orange-50 cursor-pointer",children:(0,a.jsx)(E.p4,{children:e.label})},e.value))})})})]})}let R=[{label:"Last 7 Days",value:"7d"},{label:"Last 30 Days",value:"30d"},{label:"Last 90 Days",value:"90d"}];function O(){let{isAuthenticated:e,isLoading:t}=(0,C.A)(),[s,n]=(0,r.useState)(""),[i,c]=(0,r.useState)([]),[o,d]=(0,r.useState)("7d"),[m,x]=(0,r.useState)("7d");(0,r.useEffect)(()=>{g()},[]);let g=async()=>{try{let e=u.$.getInstance(),[t,s]=await Promise.all([e.getDishCategories(),e.getAllStats()]),a=t.map(e=>({label:e.name,value:e.id}));c(a);let r=s.data.salesOfAllProducts.map(e=>({id:e.category.id,totalSales:e.dishes.reduce((e,t)=>e+t.count,0)})).sort((e,t)=>t.totalSales-e.totalSales);r.length>0?n(r[0].id):a.length>0&&n(a[0].value)}catch(e){console.error("Failed to fetch categories:",e),c([])}};return t?(0,a.jsx)("div",{children:"Loading..."}):e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Q,{items:["Cafe","Overview"]}),(0,a.jsxs)("main",{className:"flex-1 p-6",children:[(0,a.jsx)(h,{}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-500",children:"Over the days"}),(0,a.jsx)(P,{options:R,value:o,onValueChange:d})]}),(0,a.jsx)(b,{selectedTimeRange:o})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsx)("h3",{className:"text-sm text-gray-500",children:"Sales by Category or Products"})}),(0,a.jsx)(S,{})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-500",children:"Peak Operating Hours"}),(0,a.jsx)(P,{options:R,value:m,onValueChange:x})]}),(0,a.jsx)(D,{selectedTimeRange:m})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-500",children:"Most sold items by Category"}),(0,a.jsx)(P,{options:i,value:s,onValueChange:n})]}),(0,a.jsx)(A,{selectedCategory:s}),(0,a.jsx)(L,{selectedCategory:s})]})]})]})]}):(0,a.jsx)("div",{children:"You dont have access to this page"})}},41004:(e,t,s)=>{"use strict";s.d(t,{Q:()=>i});var a=s(95155),r=s(6874),l=s.n(r),n=s(13052);function i(e){let{items:t}=e;return(0,a.jsx)("div",{className:"px-6 pt-3 flex items-center text-sm",children:t.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[s>0&&(0,a.jsx)(n.A,{size:16,className:"mx-2 text-black"}),(0,a.jsx)(l(),{href:"#",className:"".concat(s===t.length-1?"text-gray-800 font-medium":"text-black hover:text-gray-700"),children:e})]},s))})}},49143:(e,t,s)=>{Promise.resolve().then(s.bind(s,31881))}},e=>{var t=t=>e(e.s=t);e.O(0,[105,997,95,945,69,355,441,684,358],()=>t(49143)),_N_E=e.O()}]);